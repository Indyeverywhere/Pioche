# Solution pour Afficher les Événements

Je comprends maintenant pourquoi les événements ne s'affichent pas. Le problème vient du format des données dans votre Google Sheet, qui contient des caractères spéciaux et des données mal formatées. Voici une version corrigée du code qui devrait résoudre ces problèmes :

```html
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Événements à Marseille | Agenda Culturel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #1e88e5;
      --secondary-color: #ff6f00;
      --background-color: #f5f7fa;
      --card-color: #ffffff;
      --text-color: #333333;
      --accent-color: #e91e63;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary-color), #0d47a1);
      color: white;
      padding: 2rem 0;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 1rem;
    }
    
    .marseille-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--secondary-color);
    }
    
    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 20px;
    }
    
    .filters {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .search-box {
      flex-grow: 1;
      max-width: 400px;
      position: relative;
    }
    
    .search-box input {
      width: 100%;
      padding: 12px 20px;
      border: 1px solid #ddd;
      border-radius: 30px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s;
    }
    
    .search-box input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(30, 136, 229, 0.2);
    }
    
    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
    }
    
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
    }
    
    .event {
      background-color: var(--card-color);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .event:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .event-image {
      height: 200px;
      overflow: hidden;
      position: relative;
    }
    
    .event-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }
    
    .event:hover .event-image img {
      transform: scale(1.05);
    }
    
    .event-content {
      padding: 1.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }
    
    .event-date {
      display: inline-block;
      background-color: var(--accent-color);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }
    
    .event h2 {
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
      color: var(--primary-color);
    }
    
    .event-description {
      margin-bottom: 1.2rem;
      color: #555;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-grow: 1;
    }
    
    .event-details {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 0.95rem;
      margin-top: auto;
    }
    
    .event-detail {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    
    .event-detail i {
      color: var(--primary-color);
      min-width: 20px;
      margin-top: 4px;
    }
    
    .no-events {
      grid-column: 1 / -1;
      text-align: center;
      padding: 3rem;
      background-color: var(--card-color);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .loading {
      text-align: center;
      padding: 2rem;
      font-size: 1.2rem;
      color: #666;
    }
    
    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 2rem 0;
      margin-top: 3rem;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .price-tag {
      display: inline-block;
      background-color: var(--secondary-color);
      color: white;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    
    .debug-info {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 20px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      display: none;
    }
    
    @media (max-width: 768px) {
      .events-grid {
        grid-template-columns: 1fr;
      }
      
      .filters {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-box {
        max-width: 100%;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="marseille-icon">
        <i class="fas fa-sun"></i>
      </div>
      <h1>Événements à Marseille</h1>
      <p class="subtitle">Découvrez tous les événements à venir dans la cité phocéenne</p>
    </div>
  </header>

  <main>
    <div class="filters">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Rechercher un événement...">
        <i class="fas fa-search search-icon"></i>
      </div>
    </div>
    
    <div id="events-container" class="events-grid">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i> Chargement des événements...
      </div>
    </div>
    
    <div id="debug-info" class="debug-info"></div>
  </main>

  <footer>
    <div class="footer-content">
      <p>&copy; 2023 Agenda des Événements à Marseille | Tous droits réservés</p>
    </div>
  </footer>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/1FGkH2h9VvGw-jmrqRP0_Gr5gJJ10aplNhSPV1yyI5_U/gviz/tq?tqx=out:json&gid=0";
    let allEvents = [];

    async function fetchEvents() {
      try {
        const response = await fetch(sheetURL);
        const text = await response.text();

        // Nettoyage JSONP → JSON
        const jsonStart = text.indexOf('{');
        const jsonEnd = text.lastIndexOf('}') + 1;
        const jsonText = text.substring(jsonStart, jsonEnd);
        const json = JSON.parse(jsonText);
        
        // Debug info
        const debugInfo = document.getElementById('debug-info');
        
        const rows = json.table.rows;
        const cols = json.table.cols.map(col => col.label);

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        allEvents = rows.map(row => {
          const event = {};
          
          // Extraire les données de chaque colonne
          cols.forEach((col, index) => {
            if (row.c && row.c[index] !== null) {
              let value = row.c[index].v || "";
              
              // Nettoyer les valeurs qui contiennent des #
              if (typeof value === 'string' && value.includes('#')) {
                value = value.replace(/#+/g, "");
              }
              
              event[col] = value;
            } else {
              event[col] = "";
            }
          });

          // Traitement de la date
          try {
            if (event["Date"]) {
              // Si la date est une chaîne, essayer de la convertir
              if (typeof event["Date"] === 'string') {
                // Supprimer les # si présents
                const cleanDate = event["Date"].replace(/#+/g, "");
                
                // Essayer de créer une date valide
                const dateParts = cleanDate.split('/');
                if (dateParts.length === 3) {
                  // Format JJ/MM/AAAA
                  const day = parseInt(dateParts[0], 10);
                  const month = parseInt(dateParts[1], 10) - 1; // Les mois commencent à 0
                  const year = parseInt(dateParts[2], 10);
                  event.eventDate = new Date(year, month, day);
                } else {
                  // Essayer de parser directement
                  event.eventDate = new Date(cleanDate);
                }
              } else {
                // Si c'est déjà un objet Date ou un timestamp
                event.eventDate = new Date(event["Date"]);
              }
              
              // Vérifier si la date est valide
              if (isNaN(event.eventDate.getTime())) {
                // Si la date n'est pas valide, utiliser la date d'aujourd'hui + 7 jours
                event.eventDate = new Date();
                event.eventDate.setDate(event.eventDate.getDate() + 7);
              }
              
              // Formater la date pour l'affichage
              event.formattedDate = event.eventDate.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
              });
            } else {
              // Si pas de date, utiliser la date d'aujourd'hui + 7 jours
              event.eventDate = new Date();
              event.eventDate.setDate(event.eventDate.getDate() + 7);
              event.formattedDate = "Date à confirmer";
            }
          } catch (e) {
            console.error("Erreur lors du traitement de la date:", e);
            event.eventDate = new Date();
            event.eventDate.setDate(event.eventDate.getDate() + 7);
            event.formattedDate = "Date à confirmer";
          }

          // Nettoyer le titre
          if (event["Titre"]) {
            event["Titre"] = event["Titre"].replace(/#+/g, "").trim();
          }
          
          // Utiliser la description courte si disponible, sinon la description complète
          if (event["ThumbnailDescriptioncourte"] && !event["Description"]) {
            event["Description"] = event["ThumbnailDescriptioncourte"];
          }
          
          // Nettoyer la description
          if (event["Description"]) {
            event["Description"] = event["Description"].replace(/#+/g, "").trim();
          }

          return event;
        });

        // Filtrer et trier les événements à venir
        const upcomingEvents = allEvents
          .filter(e => e.eventDate >= today)
          .sort((a, b) => a.eventDate - b.eventDate);

        displayEvents(upcomingEvents);
        setupSearch();
      } catch (error) {
        console.error('Erreur lors du chargement des événements :', error);
        document.getElementById('events-container').innerHTML = `
          <div class="no-events">
            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;"></i>
            <h2>Erreur lors du chargement des événements</h2>
            <p>Veuillez réessayer ultérieurement.</p>
            <p style="font-size: 0.8rem; margin-top: 1rem; color: #777;">Détail de l'erreur: ${error.message}</p>
          </div>
        `;
      }
    }

    function displayEvents(events) {
      const container =